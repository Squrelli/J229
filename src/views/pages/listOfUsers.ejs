<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title><%= title ? title : "" %></title>
        <link rel="stylesheet" href="/css/style.css">
    </head>
    <body>
        <%- include("../partials/header", {title: "List of Users"})  %>
        <main>
            <div class="block-spacing">
                <form action="/users" method="GET" class="inline-form">
                    <label for="search">Search by username:</label>
                    <input type="text" name="search" id="search" value="<%= search %>">
                    <button type="submit" class="special-button-style">Search</button>
                    <% if (search) { %>
                        <a href="/users" class="ml-10">Clear</a>
                    <% } %>
                </form>
            </div>

            <% if(users && users.length > 0){ %>
                <p>To sort, click at the column name for what you want to sort by</p>
                <table class="table-users">
                    <thead>
                        <tr>
                            <th>
                                <a href="/users?sortBy=username&sortOrder=<%= sortBy === "username" && sortOrder === "asc" ? "desc" : "asc" %>&search=<%= search %>" class="sortable-link">
                                    Username
                                    <% if (sortBy == "username") { %>
                                        <%= sortOrder == "asc" ? "↑" : "↓" %>
                                    <% } %>
                                </a>
                            </th>
                            <th>
                                <a href="/users?sortBy=age&sortOrder=<%= sortBy === "age" && sortOrder === "asc" ? "desc" : "asc" %>&search=<%= search %>" class="sortable-link">
                                    Age
                                    <% if (sortBy == "age") { %>
                                        <%= sortOrder == "asc" ? "↑" : "↓" %>
                                    <% } %>
                                </a>
                            </th>
                            <th>
                                <a href="/users?sortBy=points&sortOrder=<%= sortBy === "points" && sortOrder === "asc" ? "desc" : "asc" %>&search=<%= search %>" class="sortable-link">
                                    Points
                                    <% if (sortBy == "points") { %>
                                        <%= sortOrder == "asc" ? "↑" : "↓" %>
                                    <% } %>
                                </a>
                            </th>
                            <th>Country</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% users.forEach(user => { %>
                            <tr>
                                <td><%= user.username %></td>
                                <td><%= user.age %></td>
                                <td><%= user.points || 0 %></td>
                                <td><%= user.country || "-" %></td>
                                <td>
                                    
                                    <a href="/users/<%= user._id %>">View</a> 
                                    <a href="/users/<%= user._id %>/edit">Edit</a> 
                                    <form action="/users/<%= user._id %>/delete" method="POST" class="inline-form">
                                        <button type="submit" onclick="return confirm('Are you sure you want to delete <%= user.username %>?')" class="deleteUserButton">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            <% } else { %>
                <p>No users found.</p>
            <% } %>

            <div class="top-spacing">
                <a href="/add" class="redirect_link">Add New User</a> |
                <a href="/logout" class="redirect_link">Logout</a>
            </div>
        </main>
        <%- include("../partials/footer") %>
    </body>
</html>

